{
  "kind": "build_request",
  "title": "Fix filter syntax and force full recovery in test mode (Version 367)",
  "projectName": "FitTrack",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-5",
      "text": "In buildShuffledSectionFromArray function in backend/main.mo, replace the invalid filter syntax 'Text.equal(e.primaryMuscleGroup.toLower(), group.toLower())' with 'Text.equal(Text.toLowercase(e.primaryMuscleGroup), Text.toLowercase(group))' to fix the muscle group filtering that is currently returning empty arrays for leg exercises",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Text.equal(e.primaryMuscleGroup.toLower(), group.toLower())",
          "Text.equal(Text.toLowercase(e.primaryMuscleGroup), Text.toLowercase(group))"
        ]
      },
      "acceptanceCriteria": [
        "The filter in buildShuffledSectionFromArray uses Text.toLowercase() function instead of .toLower() method",
        "Deployed code can be read and verified to contain 'Text.toLowercase(e.primaryMuscleGroup)' in the filter"
      ]
    },
    {
      "id": "REQ-6",
      "text": "In buildShuffledSectionFromArrayWithLimit function in backend/main.mo, replace the invalid filter syntax 'Text.equal(e.primaryMuscleGroup.toLower(), group.toLower())' with 'Text.equal(Text.toLowercase(e.primaryMuscleGroup), Text.toLowercase(group))' to fix the muscle group filtering that is currently returning empty arrays for leg exercises",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Text.equal(e.primaryMuscleGroup.toLower(), group.toLower())",
          "Text.equal(Text.toLowercase(e.primaryMuscleGroup), Text.toLowercase(group))"
        ]
      },
      "acceptanceCriteria": [
        "The filter in buildShuffledSectionFromArrayWithLimit uses Text.toLowercase() function instead of .toLower() method",
        "Deployed code can be read and verified to contain 'Text.toLowercase(e.primaryMuscleGroup)' in the filter"
      ]
    },
    {
      "id": "REQ-7",
      "text": "In the adjustRecoveryForTestMode function in backend/main.mo, change the line 'let fullyRecoveredTime = 0;' to 'let fullyRecoveredTime = 0 - (100 * 3_600_000_000_000);' to force 100% recovery status for all muscle groups when TEST_RECOVERY_MODE = true",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "let fullyRecoveredTime = 0;",
          "let fullyRecoveredTime = 0 - (100 * 3_600_000_000_000);"
        ]
      },
      "acceptanceCriteria": [
        "The adjustRecoveryForTestMode function sets fullyRecoveredTime using a negative offset calculation",
        "Deployed code can be read and verified to contain 'fullyRecoveredTime = 0 - (100 * 3_600_000_000_000)'",
        "TEST_RECOVERY_MODE remains set to true"
      ]
    },
    {
      "id": "REQ-8",
      "text": "After deployment, verify that both fixes are present in the deployed backend code: confirm Text.toLowercase is used in both filter functions and fullyRecoveredTime uses the negative offset calculation",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "read the deployed code and confirm both fixes are present"
        ]
      },
      "acceptanceCriteria": [
        "Deployed main.mo file contains 'Text.toLowercase(e.primaryMuscleGroup)' in buildShuffledSectionFromArray",
        "Deployed main.mo file contains 'Text.toLowercase(e.primaryMuscleGroup)' in buildShuffledSectionFromArrayWithLimit",
        "Deployed main.mo file contains 'fullyRecoveredTime = 0 - (100 * 3_600_000_000_000)' in adjustRecoveryForTestMode"
      ]
    }
  ],
  "constraints": [
    "Keep TEST_RECOVERY_MODE = true",
    "Do not change anything else in main.mo beyond the two specified fixes",
    "Build as Version 367"
  ],
  "nonGoals": [
    "Refactoring other parts of the codebase",
    "Changing the recovery calculation logic beyond the test mode adjustment",
    "Modifying frontend components",
    "Adding new features or functionality"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}