{
  "kind": "build_request",
  "title": "Backend: Fix lower-body workout note logic and remove duplicate empty-check",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-4",
      "text": "In backend/main.mo, update generateLowerBodyWorkout() so the user-facing note logic matches exactly this 4-branch decision tree and strings:\n- If cappedExercises.size() == 0: \"All lower muscle groups recovering\"\n- Else if totalLegCount == 0: \"Core-focused session (leg subgroups recovering)\"\n- Else if cappedExercises.size() <= 3: \"Limited exercises due to muscle recovery\"\n- Else: \"Full lower-body workout\"\nDo not change any other wording.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-6"
        ],
        "quotes": [
          "Fix note logic to match exactly:\n   let note = if (cappedExercises.size() == 0) {\n     \"All lower muscle groups recovering\"\n   } else if (totalLegCount == 0) {\n     \"Core-focused session (leg subgroups recovering)\"\n   } else if (cappedExercises.size() <= 3) {\n     \"Limited exercises due to muscle recovery\"\n   } else {\n     \"Full lower-body workout\"\n   };",
          "Apply ONLY these two changes. No build."
        ]
      },
      "acceptanceCriteria": [
        "Lower-body workout generation returns a note value that is exactly one of the four specified strings, selected by the exact branch order/conditions above.",
        "The branch conditions use cappedExercises.size() and totalLegCount exactly as specified (including the <= 3 threshold in the note decision tree)."
      ]
    },
    {
      "id": "REQ-5",
      "text": "In backend/main.mo, within generateLowerBodyWorkout(), remove the first/duplicate early-return empty-check block that checks totalExerciseCount == 0. Preserve the remaining logic and behavior aside from removing that duplicated empty check.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-6"
        ],
        "quotes": [
          "Remove the first empty check block (if (totalExerciseCount == 0))",
          "Apply ONLY these two changes. No build."
        ]
      },
      "acceptanceCriteria": [
        "generateLowerBodyWorkout() no longer contains the initial duplicated conditional block that returns early when totalExerciseCount == 0.",
        "No other logic changes are introduced besides the note decision tree update (REQ-4) and this removal."
      ]
    }
  ],
  "constraints": [
    "Apply ONLY the two requested changes inside generateLowerBodyWorkout() (note decision tree rewrite + remove the first/duplicate totalExerciseCount==0 empty check).",
    "Do not modify getExerciseCountForGroup(), TEST_RECOVERY_MODE behavior, stable storage, types, or any other backend logic.",
    "No frontend changes.",
    "Do not add a migration (state schema is unchanged).",
    "Use English for user-facing strings exactly as provided."
  ],
  "nonGoals": [
    "Fixing leg exercise visibility issues in Full Body/Lower Body workouts beyond these two generateLowerBodyWorkout() cleanups.",
    "Changing any thresholds or selection logic outside the specified note logic update.",
    "Turning off test recovery mode.",
    "Any UI/JSX changes to render Core sections on the frontend."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}