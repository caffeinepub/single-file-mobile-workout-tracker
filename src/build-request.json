{
  "kind": "build_request",
  "title": "Fix Motoko Text lowercase filter so workouts include correct muscle groups",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-2",
      "text": "In backend/main.mo, in the function buildShuffledSectionFromArray, replace the entire existing `let groupExercises = exercises.filter(...)` block (currently using invalid Motoko dot-syntax like `e.primaryMuscleGroup.toLower()` / `group.toLower()`) with the following exact Motoko code, using the already-imported Text module:\n\n```motoko\n    let groupExercises = exercises.filter(func(e) {\n      Text.equal(\n        Text.toLowercase(e.primaryMuscleGroup),\n        Text.toLowercase(group)\n      )\n    });\n```\n\nKeep all other logic exactly as-is, including any `Debug.print` statements and `TEST_RECOVERY_MODE = true`.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "The Fix: Replace the entire let groupExercises filter block (Lines 117-122) with this exact code:\n\nMotoko\n    let groupExercises = exercises.filter(func(e) {\n      Text.equal(\n        Text.toLowercase(e.primaryMuscleGroup),\n        Text.toLowercase(group)\n      )\n    });\n\nRequirement: Use the Text module already imported at Line 9. Keep all other logic and TEST_RECOVERY_MODE = true exactly as they are."
        ]
      },
      "acceptanceCriteria": [
        "backend/main.mo compiles successfully with no usage of invalid `TextValue.toLower()` / dot-lowercase syntax in buildShuffledSectionFromArray.",
        "The only change inside buildShuffledSectionFromArray is replacing the `groupExercises` filter block with the exact code provided (no additional logic changes).",
        "`TEST_RECOVERY_MODE` remains set to `true` and is unchanged.",
        "Any existing debug print statements remain unchanged."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Trigger a new successful draft build after applying the backend change so the updated backend can be tested (e.g., generating a \"Lower Body\" workout should no longer return only Core exercises).",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Action: Apply this change to the backend and start a new build immediately."
        ]
      },
      "acceptanceCriteria": [
        "A new draft build completes successfully with the backend filter fix included.",
        "After the build, generating a \"Lower Body\" workout returns a variety of leg exercises (not only Core exercises)."
      ]
    }
  ],
  "constraints": [
    "Do not modify `TEST_RECOVERY_MODE` (must remain `true`).",
    "Use the existing `import Text \"mo:core/Text\";` already present in backend/main.mo (do not add a new Text import).",
    "Do not remove or alter any existing Debug.print statements or other logic outside the specified filter block replacement.",
    "Backend must remain a single-actor Motoko canister (no additional backend services)."
  ],
  "nonGoals": [
    "No frontend UI/UX changes.",
    "No changes to the exercise library contents beyond what is required to fix the filter comparison.",
    "No new workout generation features or algorithm redesign beyond correcting the lowercase/equality comparison."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}