{
  "kind": "build_request",
  "title": "Fix invalid Motoko Text lowercase filter in workout grouping",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In backend/main.mo, in the function buildShuffledSectionFromArray, replace the existing broken muscle-group filter that uses e.primaryMuscleGroup.toLower() with the exact filter below (and keep all debug prints and all other logic unchanged):\n\nlet groupExercises = exercises.filter(func(e) {\n  Text.equal(\n    Text.toLowercase(e.primaryMuscleGroup),\n    Text.toLowercase(group)\n  )\n});",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "The filter uses invalid syntax: e.primaryMuscleGroup.toLower() â€” Text has no toLower(), only Text.toLowercase().\n\nNEEDED:\nIn buildShuffledSectionFromArray, replace the broken filter with:\n\nlet groupExercises = exercises.filter(func(e) {\n  Text.equal(\n    Text.toLowercase(e.primaryMuscleGroup),\n    Text.toLowercase(group)\n  )\n});\n\nKeep all debug prints and other logic unchanged."
        ]
      },
      "acceptanceCriteria": [
        "backend/main.mo compiles without errors and no longer references e.primaryMuscleGroup.toLower() anywhere.",
        "Workout generation for Upper Body and Full Body includes non-leg muscle groups (e.g., Chest/Back/Shoulders/Arms/Core) when matching exercises exist in the library.",
        "All existing debug prints in buildShuffledSectionFromArray remain present and unchanged."
      ]
    }
  ],
  "constraints": [
    "Backend must remain single-actor (all logic in backend/main.mo).",
    "Do not change any logic in buildShuffledSectionFromArray other than the specified filter replacement.",
    "Keep all existing debug prints unchanged."
  ],
  "nonGoals": [
    "Do not refactor or redesign the workout generation algorithm beyond the specified filter fix.",
    "Do not change TEST_RECOVERY_MODE behavior or access control behavior as part of this request."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}